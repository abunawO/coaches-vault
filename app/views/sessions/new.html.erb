<div class="auth-page">
    <div class="auth-card">
        <div class="auth-brand">
            <span class="auth-brand__mark"></span>
            <span class="auth-brand__name">MyCoachVault</span>
        </div>
        <h1 class="auth-title">Welcome back</h1>
        <p class="auth-subtitle">Access your vault and subscriptions.</p>
        <p class="auth-helper">Log in to continue.</p>
        <% if @unverified_email.present? %>
        <div class="flash flash-alert" style="position:static; box-shadow:none; margin-bottom:12px;">
            <div class="flash-message">
                <strong>Please verify your email.</strong>
                <div style="margin-top:6px;">
                    <%= form_with url: resend_verification_email_path, method: :post, local: true, class: "inline-form" do %>
                    <%= hidden_field_tag :email, @unverified_email %>
                    <button type="submit" class="btn btn-secondary btn-small">Resend verification email</button>
                    <% end %>
                </div>
            </div>
        </div>
        <% end %>

        <%= form_with url: login_path, method: :post, local: true, html: { class: "auth-form" } do |form| %>
        <div class="form-row">
            <%= form.label :email %>
            <%= form.email_field :email, required: true, autofocus: true, class: "input" %>
        </div>

        <div class="form-row">
            <%= form.label :password %>
            <%= form.password_field :password, required: true, class: "input" %>
        </div>
        <div style="margin-top: 6px; margin-bottom: 10px;">
            <%= link_to "Forgot password?", forgot_password_path, class: "muted" %>
        </div>

        <div class="auth-actions">
            <%= form.submit "Log in", class: "btn btn-primary auth-submit" %>
        </div>
        <% end %>

        <% url_helpers = Rails.application.routes.url_helpers %>
        <% forgot_password_helper = [:forgot_password_path, :new_password_reset_path, :password_reset_path, :new_password_path].find { |name| url_helpers.respond_to?(name) } %>
        <% signup_helper = [:signup_path, :new_user_registration_path, :new_registration_path].find { |name| url_helpers.respond_to?(name) } %>

        <div class="auth-footer">
            <% if forgot_password_helper %>
            <%= link_to "Forgot password?", url_helpers.send(forgot_password_helper) %>
            <% end %>
            <% if forgot_password_helper && signup_helper %>
            <span class="auth-divider">â€¢</span>
            <% end %>
            <% if signup_helper %>
            <%= link_to "Create an account", url_helpers.send(signup_helper) %>
            <% end %>
            <% if forgot_password_helper.nil? && signup_helper.nil? %>
            <% fallback_path = respond_to?(:coaches_path) ? coaches_path : root_path %>
            <%= link_to "Browse coaches", fallback_path %>
            <% end %>
        </div>
    </div>
</div>