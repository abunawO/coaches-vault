<div class="container">
  <%= render "shared/page_header",
        breadcrumbs: [["Dashboard", root_path], ["My Lessons", coach_lessons_path]],
        title: content_tag(:span, "ðŸŽ“", class: "page-title-icon") + " Your Lessons",
        subtitle: "Create, edit, and manage your vault.",
        primary_action: { label: "New Lesson", url: new_coach_lesson_path(return_to: request.fullpath) } %>

  <div class="lesson-grid">
    <% @lessons.each do |lesson| %>
      <div class="mv-card mv-card--lesson"
           data-controller="lesson-card">
        <div class="mv-card__header">
          <h3 class="mv-card__title"><%= lesson.title %></h3>
          <% if lesson.description.present? %>
            <p class="mv-card__subtitle mv-card__desc" data-lesson-card-target="desc"><%= lesson.description %></p>
            <% if lesson.description.length > 140 %>
              <button type="button"
                      class="mv-card__toggle"
                      data-lesson-card-target="toggle"
                      data-action="lesson-card#toggle"
                      aria-expanded="false">
                Show more
              </button>
            <% end %>
          <% else %>
            <p class="mv-card__subtitle muted">No description provided.</p>
          <% end %>
        </div>
        <div class="mv-card__footer mv-card__actions">
          <%= link_to lesson_path(lesson), class: "icon-btn", aria: { label: "View" }, data: { tooltip: "View" } do %>
            <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M1 9s3-6 11-6 11 6 11 6-3 6-11 6S1 9 1 9Z"/><circle cx="12" cy="9" r="2.5"/></svg>
          <% end %>
          <%= link_to edit_coach_lesson_path(lesson), class: "icon-btn", aria: { label: "Edit" }, data: { tooltip: "Edit" } do %>
            <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M12 20h9"/><path d="M16.5 3.5a2.121 2.121 0 1 1 3 3L7 19l-4 1 1-4Z"/></svg>
          <% end %>
          <button type="button"
                  class="icon-btn icon-btn--danger"
                  data-action="confirm-modal#open"
                  data-confirm-title="Delete lesson?"
                  data-confirm-body="This will permanently delete this lesson. This cannot be undone."
                  data-confirm-action="<%= coach_lesson_path(lesson) %>"
                  data-confirm-method="delete"
                  data-confirm-label="Delete"
                  aria-label="Delete"
                  data-tooltip="Delete">
            <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="3 6 5 6 21 6"/><path d="M19 6v12a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6"/><path d="M10 11v6"/><path d="M14 11v6"/><path d="M15 6V4a2 2 0 0 0-2-2h-2a2 2 0 0 0-2 2v2"/></svg>
          </button>
        </div>

        <% if lesson.description.present? %>
          <div class="mv-card__overlay" data-lesson-card-target="overlay">
            <div class="mv-card__overlay-content">
              <h4 class="mv-card__overlay-title"><%= lesson.title %></h4>
              <div class="mv-card__overlay-body"><%= simple_format(lesson.description) %></div>
              <button type="button"
                      class="btn btn-secondary btn-small"
                      data-action="lesson-card#collapse">
                Show less
              </button>
            </div>
          </div>
        <% end %>
      </div>
    <% end %>
  </div>
</div>
