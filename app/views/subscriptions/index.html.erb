<div class="container">
  <div class="page-header">
    <div>
      <h1 class="page-title">My Subscriptions</h1>
      <p class="page-subtitle">Manage coaches you follow.</p>
    </div>
  </div>

  <section class="section">
    <h2>Active Subscriptions</h2>
    <% if @active_subscriptions.any? %>
      <div class="grid">
        <% @active_subscriptions.each do |sub| %>
          <% coach = sub.coach %>
          <% coach_profile = coach.coach_profile %>
          <% coach_name = coach_profile&.display_name || coach.email %>
          <div class="card">
            <div class="card-header">
              <div>
                <strong><%= coach_name %></strong>
                <p class="muted">Active since <%= (sub.started_at || sub.created_at).to_date %></p>
              </div>
            </div>
            <div class="card-actions">
              <%= link_to "Coach page", coach_profile&.slug ? coach_path(coach_profile.slug) : coaches_path, class: "btn btn-secondary" %>
              <% if coach_profile&.slug %>
                <%= link_to "Lessons", public_coach_lessons_path(coach_profile.slug), class: "btn btn-secondary" %>
              <% else %>
                <%= link_to "Lessons", lessons_path, class: "btn btn-secondary" %>
              <% end %>
              <%= button_to "Cancel", cancel_coach_subscription_path(coach), method: :delete, class: "btn btn-danger" %>
            </div>
          </div>
        <% end %>
      </div>
    <% else %>
      <div class="card empty-state">
        <p>Youâ€™re not subscribed to any coaches right now.</p>
        <p><%= link_to "Browse coaches", coaches_path, class: "btn btn-primary" %></p>
      </div>
    <% end %>
  </section>

  <section class="section">
    <h2>Previously Subscribed Coaches</h2>
    <% if @past_subscriptions.any? %>
      <div class="grid">
        <% @past_subscriptions.each do |sub| %>
          <% coach = sub.coach %>
          <% coach_profile = coach.coach_profile %>
          <% coach_name = coach_profile&.display_name || coach.email %>
          <div class="card">
            <div class="card-header">
              <div>
                <strong><%= coach_name %></strong>
                <p class="muted">Ended on <%= (sub.ended_at || sub.updated_at).to_date %></p>
              </div>
            </div>
            <div class="card-actions">
              <%= link_to "Coach page", coach_profile&.slug ? coach_path(coach_profile.slug) : coaches_path, class: "btn btn-secondary" %>
              <% if coach_profile&.slug %>
                <%= link_to "Lessons", public_coach_lessons_path(coach_profile.slug), class: "btn btn-secondary" %>
              <% else %>
                <%= link_to "Lessons", lessons_path, class: "btn btn-secondary" %>
              <% end %>
            </div>
          </div>
        <% end %>
      </div>
    <% else %>
      <div class="card empty-state">
        <p>No past subscriptions.</p>
      </div>
    <% end %>
  </section>
</div>
